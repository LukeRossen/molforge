"""
Template for creating plugin actors.

Save this in: DAMOCLES/tools/pipe/actor_plugins/your_actor_name.py

The plugin will be automatically discovered and registered.
"""

from dataclasses import dataclass
from typing import Any
import pandas as pd

from molforge.actors.base import LoggingActor
from molforge.actors.params import BaseParams

@dataclass
class YourActorParams(BaseParams):
    """Parameters for your custom actor."""
    
    # Add your custom parameters here
    param1: str = "default_value"
    param2: int = 42
    threshold: float = 0.5
    
    # Common parameters inherited from BaseParams:
    # - verbose
    # - n_jobs
    # etc.

    def _validate_params(self) -> None:
        pass

class YourCustomActor(LoggingActor):
    """
    Custom actor for your pipeline step.
    
    This actor will be automatically discovered and can be used in pipelines
    by adding 'your_step' to the steps list.
    """
    
    # Required plugin metadata
    __plugin_name__ = 'your_step'  # Use this name in pipeline steps
    __param_class__ = YourActorParams
    __extra_kwargs__ = {}  # Optional: dict of pipeline attributes to pass
    
    def __init__(self, params: YourActorParams, logger=None, **kwargs):
        """
        Initialize the actor.
        
        Args:
            params: Parameter object for this actor
            logger: Logger instance (provided by pipeline)
            **kwargs: Additional arguments from pipeline
        """
        self.method = '[YOURCUSTOM]'  # Shows in logs
        self._params = params
        
        # Set params as attributes for easy access
        for key, value in params.to_dict().items():
            setattr(self, key, value)
        
        self._setup_logging(logger)
    
    def __call__(self, input_data: pd.DataFrame) -> pd.DataFrame:
        """
        Process the input data.
        
        Args:
            input_data: DataFrame from previous pipeline step
            
        Returns:
            Processed DataFrame for next step
        """
        self.print(f"Processing {len(input_data)} molecules")
        
        # Your processing logic here
        output_data = self._process(input_data)
        
        self.print(f"Produced {len(output_data)} molecules")
        
        return output_data
    
    def _process(self, df: pd.DataFrame) -> pd.DataFrame:
        """
        Core processing logic.
        
        Implement your custom molecule processing here.
        """
        # Example: filter based on threshold
        processed = df.copy()
        
        # Your custom logic
        # processed = processed[some_condition]
        
        return processed